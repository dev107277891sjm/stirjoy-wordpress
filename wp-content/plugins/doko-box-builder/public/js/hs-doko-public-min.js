!function(o){"use strict";let t;window.doko={},window.doko.total_price=0,window.doko.box_container="",window.doko.box_contents={},window.doko.rules={},window.doko.screens={},window.doko.box_card={},window.doko.gift_messages={},window.doko.opt_management={};let d={action:"doko-get-box-display"};o(document).ready((function(){if(window.doko_bundle_id=o('input[name="doko-bundle-page-id"]').val(),window.doko_step_decoded=JSON.parse(window.doko_step_identifier),o("select.hs-dk-categories").on("change",(function(t){t.preventDefault();let e=o(this).data("bundleContentId");d={action:"doko-get-box-display",operation_type:"categories",filter_type:o('div[data-bundle-content-id="'+e+'"] select.hs-dk-options').val(),list_ids:o('div[data-bundle-content-id="'+e+'"] select.hs-dk-categories').val(),bundleContentId:e,bundleId:o(this).data("bundleId"),current_page:window.doko.current_page},o.post(doko_object.ajaxurl,d).done((function(t){o('div[data-bundle-content-id="'+e+'"]').closest(".hs-dk-products-to-add-to-box").html(t),p(),u(),_()}))})),o("select.hs-dk-categories").trigger("change"),o('textarea[name="hs-dk-gift-message-box"]').on("keyup",(function(t){let d=o(this).data("bundleScreenName");doko.gift_messages[d]=o(this).val()})),o(document).innerWidth()<=767&&o(document).innerWidth()<=767&&o(".storefront-handheld-footer-bar")){var e=o(".storefront-handheld-footer-bar").height();o("div.hs-dk-menu-fix").css("bottom",2*parseFloat(e)+"px")}o(window).resize((function(){if(o(document).innerWidth()<=767){if(o(".storefront-handheld-footer-bar")){var t=o(".storefront-handheld-footer-bar").height();o("div.hs-dk-menu-fix").css("bottom",2*parseFloat(t)+"px")}}else o("div.hs-dk-menu-fix").css("bottom","0px")})),o("a.doko-add-to-box").unbind(),o(document).on("click","a.doko-add-to-box",(function(d){d.preventDefault();var e=c("doko",12),a=window.doko.current_page,n=o(this).data("imageUrl"),s=o(this).data("productId"),p=(o(this).data("productPrice"),o(this).data("quantity")),u=o(this).data("productVariationParentId"),_=o('input[name="doko-bundle-page-id"]').val(),k={},h=o(this).data("cardMode");window.doko.cardMode=h;var m=o(this).parents("div.hs-dk-bundle-page"),b=o(m).data();k=o(this).data();var v=o(this).parent().find("span.formulus-input-wrapper").find("input.doko-bundle-qty");v&&(null==o(v).val()?(k.quantity=1,p=1):(k.quantity=o(v).val(),p=o(v).val())),p=parseInt(p),k.current_page=a,k.bundle_id=_;var g=o(this).data("productName");k.unique_id=e,wp.hooks.doAction("doko_before_calculate_add_to_box",s,k,window.doko.current_page,b),k.variation_id=u,wp.hooks.doAction("doko_after_calculate_add_to_box",s,k,window.doko.current_page,b);var f=k.options_is_checked;if(f&&(s="p"+s),"no"==h){if(o("table.doko-box-contents").length>0&&1!=a){var w;let d=parseFloat(k.productPrice);if(null!=k.options&&k.options.length>0&&f)for(var x in k.options)null!=k.options[x].amount&&(d+=k.options[x].amount);w=r(p,g,d,s),0==o('table.doko-box-contents tbody tr[data-product-id="'+s+'"]').length?(o("table.doko-box-contents tbody").append(w),o("ul.box-images").append(function(o,t=!0,d){var e="";return t||(e="doko-reset-icone-remove"),"<li class='"+e+"' data-product-id='"+d.productId+"'><i ' style='cursor: pointer;' aria-hidden='true'></i></div><div class='selected-box' ><img class='box-color' src='"+o+"'></div></li>"}(n,!1,k))):(t=o('ul.doko-box-contents li[data-product-id="'+s+'"] div.doko-qty-exposant').html(),w=r(t,g,d,s),o('table.doko-box-contents tr[data-product-id="'+s+'"]').replaceWith(w))}o("div.hs-dk-menu-fix").show(),i(e)}else o("div.hs-dk-menu-fix").hide(),o("img.hs-dk-card-image").attr("src",n),o("div.hs-dk-product-card-panel").show(),o("div.hs-dk-product-panel").hide(),window.doko.box_card.product_id=s;l()})),o("a.hs-dk-change-card").on("click",(function(){o("div.hs-dk-product-card-panel").hide(),o("div.hs-dk-product-panel").show()})),o("input.hs-dk-input-container-to").on("change",(function(){window.doko.box_card.to=o(this).val()})),o("input.hs-dk-input-container-to").trigger("change"),o("input.hs-dk-input-container-from").on("change",(function(){window.doko.box_card.from=o(this).val()})),o("input.hs-dk-input-container-from").trigger("change"),o("#message-box").on("change",(function(){window.doko.box_card.message=o(this).val()})),o("#message-box").trigger("change"),o('div.hs-dk-card-details [name="doko-note-option"]').on("change",(function(){window.doko.box_card.options=o(this).val()})),o('div.hs-dk-card-details [name="doko-note-option"]').change(),o("input#hs-dk-custom").on("keyup",(function(t){var d=o(this).val().toLowerCase();o("div.hs-dk-products-to-add-to-box h2.woocommerce-loop-product__title").length>0&&o("div.hs-dk-products-to-add-to-box h2.woocommerce-loop-product__title").each((function(t,e){var a=o(this).text().toLowerCase();o(this).closest(".status-publish")[-1!==a.indexOf(d)?"show":"hide"]()}))})),_(),o("div.hs-dk-bundle-page").hide(),o('div.hs-dk-bundle-page[data-page-id="1"]').show(),o("div.hs-dk-menu-fix").hide(),null!=doko_bundle_data&&"yes"==doko_bundle_data["enable-bottom-navigation"]&&o("div.hs-dk-menu-fix").show(),o("div.hs-dk-product-card-panel").hide();var a=1;function i(t,d=!1){var e=JSON.parse(doko_step_identifier)[window.doko.current_page];o("table.doko-box-contents").length>0&&o("table.doko-box-contents tr[data-product-id]").each((function(){o(this).children("td:nth(4)").children("a.doko-remove").unbind(),o(this).children("td:nth(4)").children("a.doko-remove").on("click",(function(){var t=o(this).parent().parent().data("productId"),d=parseInt(o('table.doko-box-contents tr[data-product-id="'+t+'"]').data("productQty")),a=parseFloat(o('table.doko-box-contents tr[data-product-id="'+t+'"]').data("productPrice"));wp.hooks.doAction("doko_before_delete_product_from_box",t,d,a),delete window.doko.box_contents[t],delete window.doko.screens[e][t],l(),o(this).parent().closest("tr").remove(),o('ul.box-images li[data-product-id="'+t+'"]').remove(),o('ul.doko-box-contents li[data-product-id="'+t+'"]').remove(),o('table.doko-box-contents tr[data-product-id="'+t+'"]').remove(),wp.hooks.doAction("doko_after_delete_product_from_box",t,d,a)}))})),o(document).on("click",'li[data-hash-code="'+t+'"] div.doko-right-sup-exposant',(function(){var t=o(this).closest("li").data("productPrice"),d=o(this).closest("li").data("productQty"),a=o(this).closest("li").data("productId");o(this).closest("li").remove(),wp.hooks.doAction("doko_before_delete_product_from_box",a,d,t),delete window.doko.box_contents[a],delete window.doko.screens[e][a],l(),o('ul.box-images li[data-product-id="'+a+'"]').remove(),o('ul.doko-box-contents li[data-product-id="'+a+'"]').remove(),o('table.doko-box-contents tr[data-product-id="'+a+'"]').remove(),wp.hooks.doAction("doko_after_delete_product_from_box",a,d,t)})),d&&o('li[data-hash-code="'+t+'"] div.doko-right-sup-exposant').trigger("click")}function n(o,t=!0){var d,e=doko_object.wc_price_args,a={decimal_sep:e.decimal_separator,currency_position:e.currency_position,currency_symbol:e.currency_symbol,trim_zeros:e.currency_format_trim_zeros,num_decimals:e.currency_format_num_decimals,html:!0};if(a.num_decimals>0){var i=Math.round(o%1*100)/100;d=parseInt(o)+i}else d=parseInt(o);if(o=o.toString().replace(".",a.decimal_sep),t){var n=a.html?'<span class="woocommerce-Price-currencySymbol">'+a.currency_symbol+"</span>":a.currency_symbol;"left"===a.currency_position?d=n+d:"right"===a.currency_position?d+=n:"left_space"===a.currency_position?d=n+" "+d:"right_space"===a.currency_position&&(d=d+" "+n),d=a.html?'<span class="woocommerce-Price-amount amount">'+d+"</span>":d}return d}function r(o,t,d,e){var a='<tr data-product-id="'+e+'" data-product-qty="'+o+'" data-product-price="'+d+'">';return a+="<td>"+t+'</td><td class="doko_style_to_hide">'+o+'</td><td class="doko_style_to_hide">'+d+"</td><td>"+d*o+"</td>",a+='<td> <a class="doko-remove" ><i class="fa fa-times" aria-hidden="true"></i></a></td>',a+="</tr>"}function c(o="",t=13){const d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=d.length;let a=o;for(let o=0;o<t;o++)a+=d.charAt(Math.floor(Math.random()*e));return a}function s(){var o=window.doko.screens,t=0;for(var d in o){var e=o[d];if(void 0!==e.qty&&void 0!==e.amount)t+=e.qty*e.amount;else for(var a in e){var i=e[a];void 0!==i.qty&&void 0!==i.amount&&(t+=i.qty*i.amount)}}return t=wp.hooks.applyFilters("doko_total_price",t,o),window.doko.total_price=t,t}function l(){let t=s();o("button.doko-total-btn").html("Total : "+n(t,!0)+" â“˜ "),o(".doko_total_details_price").html("Total : "+n(doko.total_price,!0))}function p(){o("a.doko-load-more-content-page-action").unbind(),o("a.doko-load-more-content-page-action").on("click",(function(t){t.preventDefault(),o(this).html("Loading ...");let d=0,e={bundleId:window.doko_bundle_id,bundleContentId:o(this).data("bundleContentId")},a=o(this).data("bundleContentId"),i=o('input[data-bundle-content-id="'+a+'"][name="doko_current_position"]').val();i&&(d=doko_bundle_data[a]["nb-products-per-page"]),e.action="doko-get-products-infinite-loading",e.current_position=parseInt(i)+1,e.filter_type=o('div[data-bundle-content-id="'+window.doko_step_decoded[doko.current_page]+'"] select.hs-dk-options').val(),e.list_ids=o('div[data-bundle-content-id="'+window.doko_step_decoded[doko.current_page]+'"] select.hs-dk-categories').val(),o.post(doko_object.ajaxurl,e).done((function(t){o("a.doko-load-more-content-page-action").html("Load more"),o('input[data-bundle-content-id="'+a+'"][name="doko_current_position"]').remove(),o('input[data-bundle-content-id="'+a+'"][name="doko_operation_type"]').remove();c("doko_part",10);o("ul.hs-doko-loop.products").append(t),i=o('input[data-bundle-content-id="'+a+'"][name="doko_current_position"]').val();let e=parseInt(i)+parseInt(d);o("div.woocommerce-no-products-found").length>0?(o("a.doko-load-more-content-page-action").remove(),o("div.woocommerce-no-products-found").remove()):o('input[name="doko_current_position"]').val(e),u(),_()}))}))}function u(){o("div.doko_infoButton").on("click",(function(t){t.preventDefault();var d=o(this).parent().parent().find(".doko-add-to-box").data(),e=o(this).parent().parent().find(".doko-add-to-box").clone();o("div.doko_modal div.doko_modal_product_title").empty(),o("div.doko_modal div.doko_modal_product_title").append("<h2>"+d.productName+"</h2>"),o("div.doko_modal div.doko_modal_product_img").empty(),o("div.doko_modal div.doko_modal_product_img").append('<img src="'+d.imageUrl+'" alt="doko-image" class="doko-modal-img" />'),o("div.doko_modal div.doko_modal_product_desc").empty(),o("div.doko_modal div.doko_modal_product_desc").append(o(this).data("productDescription")),o("div.doko_modal div.doko_modal_product_price").empty(),o("div.doko_modal div.doko_modal_product_price").append("<p class='doko-price-section'>"+d.productPrice+" "+d.siteCurrency+"</p>"),o("div.doko_modal div.doko_modal_product_price").append(e),o("div.doko_modal").modal()}))}function _(){o("select.doko-add-to-box-variable").on("change",(function(t){var d=o(this).val();o(this).parent().find("div.doko_wrapper_btn_variations").hide(),o(this).prevAll().find("span.price span.doko_variable_prices").hide(),o(this).parent().find('div.doko_wrapper_btn_variations[data-product-id="'+d+'"]').show(),o(this).parent().find('div.doko_wrapper_btn_variations[data-product-id="'+d+'"] a').show(),o(this).prevAll().find('span.price span.doko_variable_prices[data-product-id="'+d+'"]').show(),""!=d&&d||o(this).prevAll().find("span.doko_old_price").show()})),o("select.doko-add-to-box-variable").trigger("change")}window.doko.current_page=a,o("div#doko-giftbox-progress-bar div.step a").removeClass("active_tab_link"),o('div#doko-giftbox-progress-bar div.step[data-step-id="'+a+'"] a').addClass("active_tab_link"),o('button.doko-page-btn[data-btn-type="next"]').on("click",(function(){if(a+1>o("div.hs-dk-bundle-page").length)return!1;if(wp.hooks.doAction("doko_before_click_navigate_to_page",a),null!=doko_bundle_data&&wp.hooks.applyFilters("doko_restrict_first_page",!0,a)&&""==window.doko.box_container)return alert(doko_bundle_data["no-products-message"]),!1;o("div.hs-dk-bundle-page").length==a+1&&o("div.hs-dk-menu-box").hide(),a++,o("div.hs-dk-bundle-page").hide(),o('div.hs-dk-bundle-page[data-page-id="'+a+'"]').show(),o("div#doko-giftbox-progress-bar div.step a").removeClass("active_tab_link"),o('div#doko-giftbox-progress-bar div.step[data-step-id="'+a+'"] a').addClass("active_tab_link"),window.doko.current_page=a,wp.hooks.doAction("doko_after_click_navigate_to_page",a);const t=document.querySelector(".doko-box-section");if(t){const o=t.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:o,behavior:"smooth"})}let d=JSON.parse(doko_step_identifier);p((d[a],window.doko_bundle_id,window.doko.current_page,o('div[data-bundle-content-id="'+d[a]+'"] input[name="doko_current_position"]').val()))})),o('button.doko-page-btn[data-btn-type="prev"]').on("click",(function(){if(a-1<1)return!1;wp.hooks.doAction("doko_before_click_navigate_to_page",a),o("div.hs-dk-bundle-page").hide(),a--,o('div.hs-dk-bundle-page[data-page-id="'+a+'"]').show(),o("div#doko-giftbox-progress-bar div.step a").removeClass("active_tab_link"),o('div#doko-giftbox-progress-bar div.step[data-step-id="'+a+'"] a').addClass("active_tab_link"),window.doko.current_page=a,wp.hooks.doAction("doko_after_click_navigate_to_page",a)})),o("button.doko-restart").on("click",(function(){window.location.reload()})),o("button.doko-go-to-cart").on("click",(function(){window.location.href=doko_object.cart_page_url})),u(),window.hs_dk_init_delete_box_action=i,window.hs_dk_recalculate_total=s,window.hs_dk_recalculate_total_html=l,window.hs_dk_get_wc_price=n,o(document).on("change keydown click","input.doko-bundle-qty",(function(){let t=o(this).val(),d=o(this).data("productId"),e=(o(this).data("productName"),o(this).data("productPrice")),a=doko.current_page,i=o(this).data("productUrl"),n=JSON.parse(doko_step_identifier)[a];if(null!=doko.box_contents[d]){var r=o("ul.doko-box-contents");hs_dk_add_li_to_box({productId:d,imageUrl:i,productPrice:e,quantity:t},r,!1,!0,!0),doko.box_contents[d].product_qty=parseInt(t),doko.screens[n][d].qty=parseInt(t)}l()})),o("button.doko_total_btn_elt").on("click",(function(){o("div#doko_total_details").modal(),function(){let t=o.modal.getCurrent();var d=JSON.parse(doko_step_identifier)[window.doko.current_page];o(t.$elm[0]).on("click","a.doko-remove",(function(){var t=o(this).parent().parent().data("productId"),e=parseInt(o('table.doko_total_details tr[data-product-id="'+t+'"]').data("productQty")),a=parseFloat(o('table.doko_total_details tr[data-product-id="'+t+'"]').data("productPrice"));wp.hooks.doAction("doko_before_delete_product_from_box",t,e,a),delete window.doko.box_contents[t],delete window.doko.screens[d][t],l(),o(this).parent().closest("tr").remove(),o('ul.box-images li[data-product-id="'+t+'"]').remove(),o('ul.doko-box-contents li[data-product-id="'+t+'"]').remove(),o('table.doko-box-contents tr[data-product-id="'+t+'"]').remove(),wp.hooks.doAction("doko_after_delete_product_from_box",t,e,a)}))}()})),window.hs_dk_rebuild_total_modal=function(){let t=window.doko.screens,d=o("table.doko_select tbody"),e="";for(var a in e=wp.hooks.applyFilters("doko_before_creating_total_details_modal",e),t){let d=t[a];if("first-step"==a){let t=o('a[data-product-id="'+d.product_id+'"]').data();null!=t&&(e+="<tr class='cart_item' data-product-id='"+d.product_id+"' data-product-qty='"+d.qty+"' data-product-price='"+t.productPrice+"' data-product-currency='"+t.siteCurrency+"'><td><img src='"+t.imageUrl+"' class='doko-modal-img-preview' /></td><td>"+t.productName+"</td><td class='doko_style_to_hide'>"+t.productPrice+" "+t.siteCurrency+"</td><td class='doko_style_to_hide'>"+d.qty+"</td><td>"+d.qty*t.productPrice+" "+t.siteCurrency+"</td><td></td></tr>")}else for(var i in d){let t=d[i],a=o('a[data-product-id="'+t.product_id+'"]').data();null!=a&&(e+="<tr class='cart_item' data-product-id='"+t.product_id+"' data-product-qty='"+t.qty+"' data-product-price='"+a.productPrice+"' data-product-currency='"+a.siteCurrency+"'><td><img src='"+a.imageUrl+"' class='doko-modal-img-preview' /></td><td>"+a.productName+"</td><td class='doko_style_to_hide'>"+a.productPrice+" "+a.siteCurrency+"</td><td class='doko_style_to_hide'>"+t.qty+"</td><td>"+t.qty*a.productPrice+" "+a.siteCurrency+'</td><td><a class="doko-remove"><i class="fa fa-times" aria-hidden="true"></i></a></td></tr>')}}e=wp.hooks.applyFilters("doko_after_creating_total_details_modal",e),d.html(e)}}))}(jQuery);